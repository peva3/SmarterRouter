version: "3.8"

services:
  smarterrouter:
    image: ghcr.io/peva3/smarterrouter:latest
    container_name: smarterrouter
    ports:
      - "11436:11436"
    env_file:
      - .env
    volumes:
      - ./router.db:/app/router.db
    restart: unless-stopped
    networks:
      - smarterrouter-network
    # GPU passthrough - requires NVIDIA Container Toolkit
    # This deploy block is only used with: docker-compose --compatibility up
    # Alternatively, use: docker compose up --gpus all
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]

  # === Example Ollama Service ===
  # Uncomment to run Ollama as part of this compose setup.
  # Make sure ROUTER_OLLAMA_URL is set to http://ollama:11434 in your .env file.
  # ollama:
  #   image: ollama/ollama:latest
  #   container_name: ollama
  #   ports:
  #     - "11434:11434"
  #   volumes:
  #     - ollama-data:/root/.ollama
  #   environment:
  #     - OLLAMA_KEEP_ALIVE=-1
  #   restart: unless-stopped
  #   networks:
  #     - smarterrouter-network

networks:
  smarterrouter-network:
    driver: bridge
